# Настройте запрос:

Запрос = Новый Запрос;

Запрос.Текст = 

    "ВЫБРАТЬ

    |    ГрафикМониторинга.Пациент,

    |    ГрафикМониторинга.ПоказательЗдоровья,

    |    ГрафикМониторинга.ДатаСледующегоМониторинга

    |ИЗ

    |    РегистрСведений.ГрафикМониторинга КАК ГрафикМониторинга";

РезультатЗапроса = Запрос.Выполнить();

роцедура ПриЗаписи(Отказ)

    Для Каждого Строка Из ТабличнаяЧасть Цикл

        Запись = РегистрыСведений.ГрафикМониторинга.СоздатьЗапись();

        Запись.Пациент = Строка.Пациент;

        Запись.ПоказательЗдоровья = Строка.ПоказательЗдоровья;

        Запись.Периодичность = Строка.Периодичность;

        Запись.ДатаСледующегоМониторинга = ТекущаяДата() + Строка.Периодичность;

        Запись.Записать();

    КонецЦикла;

КонецПроцедуры

конфигураторе перейдите в раздел "Объекты данных" → "Обработки" .

Создайте новую обработку:

Название: "Анализ результатов мониторинга" .

Добавьте код для анализа данных:

Процедура Выполнить()

    Запрос = Новый Запрос;

    Запрос.Текст = 

        "ВЫБРАТЬ

        |    РезультатыМониторинга.Пациент,

        |    РезультатыМониторинга.ПоказательЗдоровья,

        |    РезультатыМониторинга.ЗначениеПоказателя,

        |    ПоказателиЗдоровья.НормальноеМинимальноеЗначение,

        |    ПоказателиЗдоровья.НормальноеМаксимальноеЗначение,

        |    Пациенты.Возраст,

        |    Пациенты.Пол

        |ИЗ

        |    РегистрНакопления.РезультатыМониторинга КАК РезультатыМониторинга

        |    ЛЕВОЕ СОЕДИНЕНИЕ Справочник.ПоказателиЗдоровья КАК ПоказателиЗдоровья

        |    ПО РезультатыМониторинга.ПоказательЗдоровья = ПоказателиЗдоровья.Ссылка

        |    ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Пациенты КАК Пациенты

        |    ПО РезультатыМониторинга.Пациент = Пациенты.Ссылка";

    

    РезультатЗапроса = Запрос.Выполнить().Выбрать();

    

    Пока РезультатЗапроса.Следующий() Цикл

        Если РезультатЗапроса.ЗначениеПоказателя < РезультатЗапроса.НормальноеМинимальноеЗначение

            ИЛИ РезультатЗапроса.ЗначениеПоказателя > РезультатЗапроса.НормальноеМаксимальноеЗначение Тогда

            

            // Определяем риски на основе возраста и пола

            Если РезультатЗапроса.Возраст > 60 ИЛИ РезультатЗапроса.Пол = "Мужской" Тогда

                Сообщить("Высокий риск осложнений у пациента: " + РезультатЗапроса.Пациент +

                          ". Показатель: " + РезультатЗапроса.ПоказательЗдоровья +

                          ". Значение: " + РезультатЗапроса.ЗначениеПоказателя);

            КонецЕсли;
ПериодХранения = Справочники.НастройкиСистемы.НайтиПоНаименованию("Основные").ПериодХраненияЗаписей;

    Если ПериодХранения = Неопределено Тогда

        ПериодХранения = 365; // По умолчанию 1 год

    КонецЕсли;



    ДатаУдаления = ТекущаяДата() - ПериодХранения;

    Запрос = Новый Запрос;

    Запрос.Текст = 

        "ВЫБРАТЬ

        |    РезультатыМониторинга.Ссылка

        |ИЗ

        |    РегистрНакопления.РезультатыМониторинга КАК РезультатыМониторинга

        |ГДЕ

        |    РезультатыМониторинга.ДатаМониторинга < &ДатаУдаления";

    Запрос.УстановитьПараметр("ДатаУдаления", ДатаУдаления);



    РезультатЗапроса = Запрос.Выполнить().Выбрать();

    Пока РезультатЗапроса.Следующий() Цикл

        Объект = РезультатЗапроса.Ссылка.ПолучитьОбъект();
Запрос = Новый Запрос;

Запрос.Текст = 

    "ВЫБРАТЬ

    |    Заболевания.Наименование КАК Заболевание,

    |    КОЛИЧЕСТВО(РезультатыМониторинга.Пациент) КАК КоличествоМониторингов,

    |    СРЕДНЕЕ(РезультатыМониторинга.ЗначениеПоказателя) КАК СреднееЗначение,

    |    МАКСИМУМ(РезультатыМониторинга.ЗначениеПоказателя) КАК МаксимальноеЗначение,

    |    МИНИМУМ(РезультатыМониторинга.ЗначениеПоказателя) КАК МинимальноеЗначение

    |ИЗ

    |    РегистрНакопления.РезультатыМониторинга КАК РезультатыМониторинга

    |    ЛЕВОЕ СОЕДИНЕНИЕ Справочник.Заболевания КАК Заболевания

    |    ПО РезультатыМониторинга.ПоказательЗдоровья = Заболевания.Ссылка

    |СГРУППИРОВАТЬ ПО

    |    Заболевания.Наименование";


        Объект.Удалить();

    КонецЦикла;

КонецПроцедуры


        КонецЕсли;

    КонецЦикла;

КонецПроцедуры

